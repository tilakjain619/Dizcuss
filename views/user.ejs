<!-- user.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/photos/brand/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../assets/photos/brand/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../assets/photos/brand/favicon-16x16.png">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/user.css">
    <title>User Profile</title>
</head>

<body>
    <%- include('sidebar', { currentPage: 'Profile' }) %>
    <section class="home-container">
        <p class="username-title">
            <%= user.username %>
        </p>
        <!-- HTML button element -->
        <button id="followButton" data-user-id="<%= user._id %>">Follow</button>

        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'User-Discussion')">Discussions</button>
            <button class="tablinks" onclick="openTab(event, 'User-Replies')">Replies</button>
        </div>

        <div id="User-Discussion" class="tabcontent">
            <ul>
                <% discussions.forEach(discussion=> { %>
                <li>
                    <%= discussion.content %>
                </li>
                <% }); %>
            </ul>
        </div>

        <div id="User-Replies" class="tabcontent">
            <% discussions.forEach(discussion=> { %>
            <h3>
                <%= discussion.content %>
            </h3>
            <ul>
                <% discussion.replies.forEach(reply=> { %>
                <li>
                    <%= reply.content %>
                </li>
                <% }); %>
            </ul>
            <% }); %>
        </div>
    </section>
    <!-- Display other user profile information and discussions as needed -->
    <script src="../assets/js/script.js"></script>
    <script>
        // Get the button element and user ID
        const followButton = document.getElementById('followButton');
        const userId = followButton.getAttribute('data-user-id');

        // Function to update the button text and toggle Follow/Unfollow
        async function toggleFollowUnfollow() {
            try {
                const response = await fetch(`/toggleFollow/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // Include credentials if needed (e.g., for cookies)
                    credentials: 'include',
                });

                if (response.ok) {
                    // Toggle Follow/Unfollow
                    const data = await response.json();
                    followButton.textContent = data.isFollowing ? 'Unfollow' : 'Follow';
                } else {
                    console.error('Toggle Follow/Unfollow request failed');
                }
            } catch (error) {
                console.error('Error toggling Follow/Unfollow:', error);
            }
        }

        // Add a click event listener to the button
        followButton.addEventListener('click', toggleFollowUnfollow);

        // Fetch the initial follow status and update the button text when the page loads
        async function fetchInitialFollowStatus() {
            try {
                const response = await fetch(`/follow/status/${userId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // Include credentials if needed (e.g., for cookies)
                    credentials: 'include',
                });

                if (response.ok) {
                    const data = await response.json();
                    followButton.textContent = data.isFollowing ? 'Unfollow' : 'Follow';
                } else {
                    console.error('Failed to fetch follow status');
                }
            } catch (error) {
                console.error('Error fetching follow status:', error);
            }
        }

        // Call the function to fetch the initial follow status when the page loads
        fetchInitialFollowStatus();
    </script>
        </body>


</html>