<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Support Page</title>
</head>
<body>
    <h1>Admin Support Page</h1>

    <form>
        <label for="filter">Filter by:</label>
        <select id="filterSelect">
            <option value="All">All</option>
            <option value="Contact">Contact</option>
            <option value="Feedback">Feedback</option>
            <option value="Complaint">Complaint</option>
        </select>
    </form>

    <div id="supportRequests">
        <!-- Support requests will be displayed here -->
    </div>
    <script>
        const filterSelect = document.getElementById('filterSelect');
        const supportRequestsContainer = document.getElementById('supportRequests');
        // Function to fetch support requests from the server
        const fetchSupportRequestsFromServer = async () => {
            try {
                const response = await fetch('/admin/support');
                const data = await response.json();

                if (response.ok) {
                    return data.requests;
                } else {
                    console.error('Error fetching support requests');
                    return [];
                }
            } catch (error) {
                console.error(error);
                return [];
            }
        };

        // Function to delete a support request
        const deleteSupportRequest = async (requestId) => {
            try {
                const response = await fetch(`/admin/support/delete/${requestId}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    // Request was deleted successfully, update the UI
                    const deletedElement = document.getElementById(`support-request-${requestId}`);
                    if (deletedElement) {
                        deletedElement.remove();
                    }
                } else {
                    console.error('Error deleting support request');
                }
            } catch (error) {
                console.error(error);
            }
        };

        // Function to display support requests
        const displaySupportRequests = (requests) => {
            supportRequestsContainer.innerHTML = ''; // Clear previous requests

            requests.forEach(request => {
                const requestElement = document.createElement('div');
                requestElement.textContent = `Type: ${request.type}, Message: ${request.content}, Email: ${request.contactInfo}`;
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => {
                    deleteSupportRequest(request._id);
                });
                requestElement.appendChild(deleteButton);
                requestElement.id = `support-request-${request._id}`;
                supportRequestsContainer.appendChild(requestElement);
            });
        };

        // Function to filter and display support requests on the client side
        const filterAndDisplaySupportRequests = async (filter) => {
            const allSupportRequests = await fetchSupportRequestsFromServer();

            if (filter === 'All') {
                // Display all support requests
                displaySupportRequests(allSupportRequests);
            } else {
                // Filter support requests based on the selected filter
                const filteredRequests = allSupportRequests.filter(request => request.type === filter);
                displaySupportRequests(filteredRequests);
            }
        };

        // Listen for changes in the filter select element
        filterSelect.addEventListener('change', () => {
            const selectedFilter = filterSelect.value;
            filterAndDisplaySupportRequests(selectedFilter);
        });

        // Initially load all support requests
        filterAndDisplaySupportRequests('All');
    </script>
</body>
</html>
